<!doctype html><html data-theme=night lang=en-us dir=ltr class=scroll-smooth><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Home Networking Setup | harrigan.xyz</title>
<link href=https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css rel=stylesheet><link rel=stylesheet href=/css/main.min.86f2bde4095248057f7e93e6d1d339f5355d5b575fa12c44859cc416abf30395.css integrity="sha256-hvK95AlSSAV/fpPm0dM59TVdW1dfoSxEhZzEFqvzA5U=" crossorigin=anonymous>hello
<script defer src=/js/main.399f36bf66ff811bab5a2140358e94beb4621123d78fb560822ececb0594fd95.js integrity="sha256-OZ82v2b/gRurWiFANY6UvrRiESPXj7Vggi7OywWU/ZU=" crossorigin=anonymous></script></head><body><div class=drawer x-data x-bind=keyboard><input id=sidebar type=checkbox class=drawer-toggle x-model=$store.sidebar.open><div class=drawer-content><div class="navbar bg-base-100 z-30"><div class=flex-none><div class="tooltip tooltip-bottom" data-tip=⌘E><label for=sidebar aria-label="open sidebar" class="btn btn-square btn-ghost"><i class="bx bx-menu-alt-left bx-sm"></i></label></div></div><div class=flex-1><a class="btn btn-ghost text-xl" href=/>harrigan.xyz</a></div><div class="absolute m-auto left-1/4 w-1/2 hidden"><label class="searchbox relative w-full"><i class="bx bx-search absolute my-4 ms-4 opacity-40 text-base-content"></i><div class=flex-1><input type=text placeholder=Search name=search class="input input-bordered ps-10 w-full" x-ref=search autocomplete=off></div><div class="pointer-events-none absolute end-6 top-2.5 gap-1 opacity-50 rtl:flex-row-reverse md:block hidden"><kbd class="kbd kbd-sm">⌘</kbd>
<kbd class="kbd kbd-sm">K</kbd></div></label></div><div class="flex-none pr-4"><label class="swap swap-rotate"><input type=checkbox class="theme-controller hidden" value=retro x-data=theme x-model=light x-on:click=toggle()><svg class="swap-on fill-current w-8 h-8" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 24"><path d="M5.64 17l-.71.71a1 1 0 000 1.41 1 1 0 001.41.0l.71-.71A1 1 0 005.64 17zM5 12a1 1 0 00-1-1H3a1 1 0 000 2H4a1 1 0 001-1zm7-7a1 1 0 001-1V3a1 1 0 00-2 0V4a1 1 0 001 1zM5.64 7.05a1 1 0 00.7.29 1 1 0 00.71-.29 1 1 0 000-1.41l-.71-.71A1 1 0 004.93 6.34zm12 .29a1 1 0 00.7-.29l.71-.71a1 1 0 10-1.41-1.41L17 5.64a1 1 0 000 1.41 1 1 0 00.66.29zM21 11H20a1 1 0 000 2h1a1 1 0 000-2zm-9 8a1 1 0 00-1 1v1a1 1 0 002 0V20a1 1 0 00-1-1zm6.36-2A1 1 0 0017 18.36l.71.71a1 1 0 001.41.0 1 1 0 000-1.41zM12 6.5A5.5 5.5.0 1017.5 12 5.51 5.51.0 0012 6.5zm0 9A3.5 3.5.0 1115.5 12 3.5 3.5.0 0112 15.5z"/></svg><svg class="swap-off fill-current w-8 h-8" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21.64 13a1 1 0 00-1.05-.14 8.05 8.05.0 01-3.37.73A8.15 8.15.0 019.08 5.49a8.59 8.59.0 01.25-2A1 1 0 008 2.36 10.14 10.14.0 1022 14.05 1 1 0 0021.64 13zm-9.5 6.69A8.14 8.14.0 017.08 5.22v.27A10.15 10.15.0 0017.22 15.63a9.79 9.79.0 002.1-.22 8.11 8.11.0 01-7.18 4.32z"/></svg></label></div></div><div class="mx-auto max-w-screen-lg min-h-screen px-3 py-6"><article class="prose mx-auto py-6"><h1 class=tracking-tight>Home Networking Setup</h1><div class="pb-2 text-base-content/50 text-sm"><time datetime=2023-12-01T00:00:00+00:00>Dec 1, 2023</time>
<span>·</span>
<span>5 min</span></div><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase link link-accent" href=/tags/homelab>homelab</a></div><div class=divider></div><p><p>First order of business is establishing how my network is setup.
There are two main problems I want to solve.</p><ol><li>Making sure my network is secure. Devices should not have free-for-all
access to everything on the home network.</li><li>I don&rsquo;t want to deal with IPs (as much as possible) for the services running
at home. IPs often become a chore and I don&rsquo;t want to think about them - I want
to treat my services as cattles, not pets. I <em>need</em> DNS.</li></ol><h2 id=vlan>VLAN</h2><p>VLAN partitions a network into multiple logical networks. As an example, IoT
devices can be a part of a VLAN. This allows control of what the IoT devices can
and cannot access. Growing number of devices connected to a network increases
the surface area for a potential attack from a bad actor gaining access an
insecure device. Having the ability to partition and control network access is
critical to keeping your important data and devices away from threats.</p><p>My current hardware is the TP-Link Omada stack which I will be using to create
VLANs and configure my network.</p><figure><img src=/posts/homelab/2023-12-01-networking/networking-devices.png alt="my networking devices"></figure><ul><li>16 port switch <a href=https://a.co/d/9FQY8Cy>TL-SG2218</a></li><li>8 port PoE switch <a href=https://a.co/d/hABgCyD>TL-SG2210MP</a></li><li>Router <a href=https://a.co/d/98ADwa8>TP-Link ER605</a></li><li>Omada hardware controller <a href=https://a.co/d/1O6YGqZ>OC200</a></li></ul><p>I&rsquo;m going to organize my network into the following segments:</p><table><thead><tr><th>VLAN</th><th>CIDR</th></tr></thead><tbody><tr><td>Management</td><td><code>192.168.10.0/24</code></td></tr><tr><td>Users</td><td><code>192.168.20.0/24</code></td></tr><tr><td>Servers</td><td><code>192.168.42.0/24</code></td></tr><tr><td>IoT</td><td><code>192.168.50.0/24</code></td></tr></tbody></table><p><strong>Management</strong> is the most restricted space and should only be accessible from
<strong>Users</strong>. This segment includes: Proxmox, Dell iDRAC interface, and the
networking devices.</p><p><strong>Users</strong> contains all of the personal devices.</p><p><strong>Services</strong> is the fun part, this contains all physical and virtual machines,
as well as some virtual IPs.</p><p><strong>IoT</strong> contains all the smart devices. These should only be able to speak to
the internet, and are cutoff from connecting to other devices on the network.
This <em>might</em> need some tweaking later depending on the device.</p><p>And what each VLAN can access:</p><table><thead><tr><th>VLAN</th><th>Access</th></tr></thead><tbody><tr><td>Management</td><td>All</td></tr><tr><td>Users</td><td>All</td></tr><tr><td>Servers</td><td>IoT</td></tr><tr><td>IoT</td><td>None</td></tr></tbody></table><p>I think this is a good enough starting point. I plan to apply some revisions when it makes sense to do so like:</p><ul><li>VLAN for guests.</li><li>VLAN for IP cameras.</li><li>Locking down access to <code>Management</code> from <code>Users</code>.</li><li>Access rule for <code>IoT</code> devices, some devices might need access to <code>Servers</code> and
<code>Users</code> VLAN.</li></ul><h2 id=dns-and-dhcp>DNS and DHCP</h2><p>If you&rsquo;re not familiar, DHCP is a service that assigns IP addresses to devices
on a network. Your router usually runs this service. DNS translates domain names
like <code>google.com</code> and <code>db-1.lan</code> IP addresses that computers use to identity
each other.</p><p>To limit the use of IPs, I would like to use DNS as much possible. It&rsquo;s
difficult having to remember IPs and organize them in logical formats for
different services as the number of services grow and shrink. I also would
prefer not to create DNS records for my local services manually.</p><p>DNS and DHCP work nicely together to automatically resolve local hostnames.</p><p>Ideally, my router can take on this task, but <a href=https://community.tp-link.com/en/business/forum/topic/542472>Omada sadly doesn&rsquo;t have a DNS
server</a>. Hopefully
is implemented at some point. At some point, I&rsquo;d like to get a machine running
<a href=https://opnsense.org/>opnsense</a> so that critical services like DNS and DHCP
can run in an &ldquo;network appliance&rdquo;.</p><p>After looking at several options, I decided on using
<a href=https://pi-hole.net/>pihole</a> for DNS and DHCP. <code>pihole</code> uses <code>dnsmasq</code> under
the hood which supports both of these protocols. I am using Ansible to install
<code>pihole</code>, but the <a href=https://github.com/pi-hole/pi-hole/#one-step-automated-install>official
methods</a> are
pretty straightfoward. (Shout out
<a href=https://github.com/r-pufky/ansible_pihole>r-pufky/ansible_pihole</a> for the
Ansible role I&rsquo;m using).</p><h3 id=using-pihole-for-dns>Using PiHole for DNS</h3><p>PiHole is deployed in my <code>Servers</code> VLAN. This is one of the only service where I
assign a fixed IP of <code>192.168.42.10</code>.</p><p>Using PiHole for DNS is very simple. After all, that&rsquo;s kinda its purpose. All
that&rsquo;s required is to change some configuration to use <code>192.168.42.10</code> (or
whatever the IP of your PiHole is) as the primary DNS server. I&rsquo;m also using
<code>1.1.1.1</code> as my secondary DNS so my machines can continue to resolve DNS if for
some reason PiHole is not operational. I applied this configuration at my router
for <code>Management</code>, <code>Servers</code>, and <code>Users</code> VLANs so that the devices in these
networks use PiHole by default for DNS.</p><h3 id=using-pihole-for-dhcp>Using PiHole for DHCP</h3><p>This is the magical part. By using the DHCP server on PiHole, PiHole can
automatically assign DNS based on the machine&rsquo;s hostname when the DHCP server
assigns an IP.</p><p>DHCP is a critical service, if it&rsquo;s down, IPs cannot be assigned. I&rsquo;m only using
PiHole DHCP for devices in the <code>Servers</code> VLAN to limit the blast radius. Only
these devices will automatically receive a DNS name - which is fine by me.</p><p>In the <code>DHCP</code> tab of PiHole Settings page, make sure the DHCP server is enabled.
Then assign the range of IP addresses that DHCP server will handout. This is
important to ensure any static IPs do not conflict with IPs DHCP will assign. I
set my range to <code>192.168.42.100</code> - <code>192.168.42.250</code>. Router Gateway in my case is
<code>192.168.42.1</code>.</p><p>Specify <code>Pi-hole</code> domain name under <code>Advanced DHCP settings</code>. I set mine to
<code>lan</code>. This makes it so that DNS record assigned to devices become
<code>&lt;hostname>.&lt;pi-hole-domain></code>.</p><p>The result of this configuration will look like:</p><figure><img src=/posts/homelab/2023-12-01-networking/dhcp-leases.png alt="dhcp leases"></figure><p>Where I can access my NAS by using <code>nas-1.lan</code>, etc.</p><h2 id=wrapping-up>Wrapping Up</h2><p>I used VLAN to segment my local network into four, and configured access policy
to tighten communication between devices.</p><p>I also used PiHole as by DNS/DHCP solution so that I don&rsquo;t have to care about IP
addresses as much and resolve servers using DNS. We&rsquo;ll dive into DNS a little
more in the future for services running in containers.</p><h3 id=result>Result</h3><table><thead><tr><th>VLAN</th><th>CIDR</th></tr></thead><tbody><tr><td>Management</td><td><code>192.168.10.0/24</code></td></tr><tr><td>Users</td><td><code>192.168.20.0/24</code></td></tr><tr><td>Servers</td><td><code>192.168.42.0/24</code></td></tr><tr><td>IoT</td><td><code>192.168.50.0/24</code></td></tr></tbody></table><table><thead><tr><th>Fixed IP</th><th>IPs</th></tr></thead><tbody><tr><td>DNS / DHCP</td><td><code>192.168.42.10</code></td></tr><tr><td>DHCP Range</td><td><code>192.168.42.100 - 192.168.42.250</code></td></tr></tbody></table></p></article><div class="flex justify-between prose mx-auto"><div class=flex-1><a class="btn btn-neutral btn-md gap-3" href=https://harrigan.xyz/posts/homelab/2023-07-21-introduction/><i class="bx bx-chevron-left"></i><div class="flex flex-col items-start"><span class="text-neutral-content/50 text-xs">Prev</span>
<span>Homelab Introduction</span></div></a></div><div></div></div></div><footer class="footer footer-center p-4 bg-base-300 text-base-content"><aside><p>Copyright 2023. All rights reserved.</p></aside></footer></div><div class="drawer-side z-10" style=scroll-behavior:smooth;scroll-padding-top:5rem><label for=sidebar aria-label="close sidebar" class=drawer-overlay></label><aside class="min-h-screen w-80 bg-base-200"><div class=navbar><div class=flex-1><a class="btn btn-ghost text-xl" href=/>harrigan.xyz</a></div><div class=flex-none><div class="tooltip tooltip-bottom" data-tip=⌘E><label for=sidebar aria-label="open sidebar" class="btn btn-square btn-ghost"><i class="bx bx-x bx-sm bx-tada-hover"></i></label></div></div></div><ul class="menu p-4"><li><a href=/posts><i class="bx bx-note bx-sm"></i>Latest Posts</a></li><li><a href=/posts/homelab><i class="bx bxl-kubernetes bx-sm"></i>Homelab Stuff</a></li><li></li><li><details><summary><i class="bx bx-purchase-tag bx-sm text-accent"></i>Tags</summary><ul><li><a href=/tags/development/ title="All pages with tag <i>development</i>">development
<sup>2</sup></a></li><li><a href=/tags/go/ title="All pages with tag <i>go</i>">go
<sup>2</sup></a></li><li><a href=/tags/homelab/ title="All pages with tag <i>homelab</i>">homelab
<sup>2</sup></a></li><li><a href=/tags/testing/ title="All pages with tag <i>testing</i>">testing
<sup>2</sup></a></li></ul></details></li><li></li><li><a href=https://github.com/davidharrigan><i class="bx bxl-github bx-sm"></i>Github</a></li><li><a href=https://www.linkedin.com/in/david-t-harrigan><i class="bx bxl-linkedin bx-sm"></i>Linkedin</a></li></ul></aside></div></div></body></html>